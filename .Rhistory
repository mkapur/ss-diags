nm$New.names[nm$Current.names %in% names(idxProf)
_
nm$New.names[nm$Current.names %in% names(idxProf)
]
nm$New.names[nm$Current.names %in% names(idxProf)]
c(nm$New.names[nm$Current.names %in% names(idxProf)], 'LNR0') # ## swap na
c(paste(nm$New.names[nm$Current.names %in% names(idxProf)], 'LNR0'))
names(idxProf) <- c(paste(nm$New.names[nm$Current.names %in% names(idxProf)]), 'LNR0') # ## swap names
idxProf
lencompProf
lencompProf <-  data.frame(read.table("./_mod/atl_tuna_max/Profile.csv", skip = 1, sep = ",", header =TRUE)[,10:13]) %>% mutate(r0vec)
names(lencompProf)[4] <- "Medits15_16"
lencompProf
names(lencompProf) <- c(nm$New.names[nm$Current.names %in% names(lencompProf)], 'LNR0') ## swap names
lencompProf
recProf <- read.table("./_mod/atl_tuna_max/Profile.csv", skip = 1, sep = ",", header =TRUE)[,1:6]
agecompProf <- data.frame("OTB_ITA" = read.table("./_mod/atl_tuna_max/Profile.csv", skip = 1, sep = ",", header =TRUE)[,8]) %>% mutate(r0vec)
names(agecompProf) <- c(paste(nm$New.names[nm$Current.names %in% names(agecompProf)]), 'LNR0') ## swap names
lencompProf <-  data.frame(read.table("./_mod/atl_tuna_max/Profile.csv", skip = 1, sep = ",", header =TRUE)[,10:13]) %>% mutate(r0vec)
names(lencompProf)[4] <- "Medits15_16"
names(lencompProf) <- c(paste(nm$New.names[nm$Current.names %in% names(lencompProf)]), 'LNR0') ## swap names
idxProf <- data.frame("Medits15_16" = read.table("./_mod/atl_tuna_max/Profile.csv", skip = 1, sep = ",", header =TRUE)[,15])   %>% mutate(r0vec)
names(idxProf) <- c(paste(nm$New.names[nm$Current.names %in% names(idxProf)]), 'LNR0') # ## swap names
lencompProf
idxProf
## run code to generate objects
# source('./Residuals/ss3residualsdiag.R') ## calls ss3runsFun within it
lendat <- get_ss3compsTA1.8(base_case,type="len") # here size (default is length)
get_ss3compsTA1.8 <- function(ss3rep,type=c('len','age','size','con'),fleet=NULL,
part = 0:2,pick.gender = 0:3,seas = NULL,method = NULL,
plotit = TRUE,maxpanel = 1000){
# Check the type is correct and the pick.gender is correct
is.in <- function (x, y)!is.na(match(x, y))
if(!is.in(type[1],c('age','len','size','con'))){
stop('Composition type incorrectly speficied')
}else{
if(sum(!is.in(pick.gender,c(0:3)))>0){
stop('Unrecognised value for pick.gender')
}
}
# Select the type of datbase
dbase <- ss3rep[[paste0(type[1],'dbase')]]
if(is.null(fleet)) fleet = unique(dbase$Fleet)
sel <-  is.in(dbase$Fleet,fleet) & is.in(dbase$Part,part)
if(type[1]!='con')sel <- sel & is.in(dbase$Sexes,pick.gender)
if(type[1]=='size' & !is.null(method)) sel <- sel & is.in(dbase$method,method)
if(sum(sel)==0) return()
dbase <- dbase[sel,]
if(is.null(seas)){
seas <- 'comb'
if(length(unique(dbase$Seas))>1)
cat('Warning: combining data from multiple seasons\n')
}
# create label for partitions
partitions <- sort(unique(dbase$Part)) # values are 0, 1, or 2
partition.labels <- c("whole","discarded","retained")[partitions+1]
partition.labels <- paste("(",paste(partition.labels,collapse="&")," catch)",sep="")
gender.flag <- type[1]!='con' & max(tapply(dbase$Sexes,
dbase$Fleet,function(x)length(unique(x))))>1
indx <- paste(dbase$Fleet,dbase$Yr,if(type[1]=='con')dbase$'Lbin_lo' else
'',if(seas=='sep')dbase$Seas else '')
if(gender.flag)indx <- paste(indx,dbase$Sexes)
method.flag <- if(type[1]=='size') length(unique(dbase$method))>1 else FALSE
if(method.flag)
indx <- paste(indx,dbase$method)
uindx <- unique(indx)
if(length(uindx)==1){
# presumably the method is meaningless of there's only 1 point,
# but it's good to be able to have the function play through
cat('Warning: only one point to plot\n')
return()
}
pldat <- matrix(0,length(uindx),10,
dimnames=list(uindx,
c('Obsmn','Obslo','Obshi','semn','Expmn','Std.res',
'ObsloAdj','ObshiAdj','Fleet','Yr')))
if(type[1]=='con')pldat <- cbind(pldat,Lbin=0)
if(gender.flag)pldat <- cbind(pldat,pick.gender=0)
if(method.flag)pldat <- cbind(pldat,method=0)
# Find the weighting factor for this combination of factors
for(i in 1:length(uindx)){  # each row of pldat is an individual comp
subdbase <- dbase[indx==uindx[i],]
xvar <- subdbase$Bin
pldat[i,'Obsmn'] <- sum(subdbase$Obs*xvar)/sum(subdbase$Obs)
pldat[i,'Expmn'] <- sum(subdbase$Exp*xvar)/sum(subdbase$Exp)
pldat[i,'semn'] <- sqrt((sum(subdbase$Exp*xvar^2)/sum(subdbase$Exp)-
pldat[i,'Expmn']^2)/mean(subdbase$N))
pldat[i,'Obslo'] <- pldat[i,'Obsmn']-2*pldat[i,'semn']
pldat[i,'Obshi'] <- pldat[i,'Obsmn']+2*pldat[i,'semn']
pldat[i,'Std.res'] <- (pldat[i,'Obsmn']-pldat[i,'Expmn'])/pldat[i,'semn']
pldat[i,'Fleet'] <- mean(subdbase$Fleet)
pldat[i,'Yr'] <- mean(if(seas=='comb')subdbase$Yr else subdbase$Yr.S)
if(type[1]=='con')pldat[i,'Lbin'] <- mean(subdbase$'Lbin_lo')
if(gender.flag)
pldat[i,'pick.gender'] <- mean(subdbase$'Pick_gender')
if(method.flag)
pldat[i,'method'] <- mean(subdbase$method)
}
Nmult <- 1/var(pldat[,'Std.res'],na.rm=TRUE)
# Find the adjusted confidence intervals
for(i in 1:length(uindx)){
pldat[i,'ObsloAdj'] <- pldat[i,'Obsmn']-2*pldat[i,'semn']/sqrt(Nmult)
pldat[i,'ObshiAdj'] <- pldat[i,'Obsmn']+2*pldat[i,'semn']/sqrt(Nmult)
}
Nfleet <- length(unique(pldat[,'Fleet']))
# make plot if requested
if(plotit){
plindx <- if(type[1]=='con'){
paste(pldat[,'Fleet'],pldat[,'Yr'])
}else{
pldat[,'Fleet']
}
if(gender.flag)plindx <- paste(plindx,pldat[,'pick.gender'])
if(method.flag)plindx <- paste(plindx,pldat[,'method'])
uplindx <- unique(plindx)
# Select number of panels
Npanel <- length(uplindx)
## Ian T. 9/25/14: changing from having at least 4 panels to no minimum
#NpanelSet <- max(4,min(length(uplindx),maxpanel))
NpanelSet <- min(length(uplindx),maxpanel)
Nr <- ceiling(sqrt(NpanelSet))
Nc <- ceiling(NpanelSet/Nr)
# save current graphical parameters
par_current <- par()
# set new parameters
par(mfrow=c(Nr,Nc),mar=c(2,2,1,1)+0.1,mgp=c(0,0.5,0),oma=c(1.2,1.2,0,0),
las=1)
par(cex=1)
for(i in 1:Npanel){
subpldat <- pldat[plindx==uplindx[i],,drop=FALSE]
x <- subpldat[,ifelse(type[1]=='con','Lbin','Yr')]
plot(x,subpldat[,'Obsmn'],pch='-',
xlim=if(length(x)>1)range(x) else c(x-0.5,x+0.5),
ylim=range(subpldat[,c('Obslo','Obshi','ObsloAdj','ObshiAdj','Expmn')],
na.rm=TRUE),
xlab='',ylab='')
segments(x,subpldat[,'Obslo'],x,subpldat[,'Obshi'],lwd=3)
arrows(x,subpldat[,'ObsloAdj'],x,subpldat[,'ObshiAdj'],lwd=1,
length=0.04, angle=90, code=3)
points(x,subpldat[,'Obsmn'],pch=21,bg='grey80')
ord <- order(x)
if(length(x)>1){
lines(x[ord],subpldat[ord,'Expmn'],col=4)
}else{
lines(c(x-0.5,x+0.5),rep(subpldat[,'Expmn'],2),col=4)
}
# Lines
fl <- ss3rep$FleetNames[subpldat[1,'Fleet']]
yr <- paste(subpldat[1,'Yr'])
lab <- if(type[1]=='con')ifelse(Nfleet>1,paste(yr,fl),yr) else fl
if(gender.flag)lab <-
paste(lab,ifelse(subpldat[1,'pick.gender']==0,'comb','sex'))
if(method.flag)lab <- paste(lab,'meth',subpldat[1,'method'])
lab <- paste(lab,partition.labels)
mtext(lab,side=3,at=mean(x))
}
mtext(paste('Mean',ifelse(is.in(type[1],c('len','size')),'length','age')),
side=2,las=0,outer=TRUE)
mtext(ifelse(type[1]=='con','Length','Year'),side=1,outer=TRUE)
# restore previous graphics parameters
par(mfrow=par_current$mfrow, mar=par_current$mar, mgp=par_current$mgp,
oma=par_current$oma, las=par_current$las)
}
tmp <- matrix(sample(pldat[,'Std.res'],1000*nrow(pldat),replace=TRUE),nrow(pldat))
confint <- as.vector(quantile(apply(tmp,2,function(x)1/var(x,na.rm=TRUE)),
c(0.025,0.975),na.rm=TRUE))
Output <- c(w=Nmult,lo=confint[1],hi=confint[2])
Outs <- paste("Francis Weights - ", type[1], ": ", ss3rep$FleetNames[fleet],": ",
round(Nmult,4), " (",round(confint[1],4),"-",round(confint[2],4),")",
sep="")
print(Outs)
pldat=data.frame(pldat)
yrs=pldat$Yr
comps_out  = list(ss_out = pldat ,runs_dat = data.frame(Fleet=pldat$Fleet,Fleet_name=ss3rep$FleetNames[pldat$Fleet],Yr=yrs,
Obs=pldat$Obsmn,Exp=pldat$Expmn))
# return(Output)
return(comps_out)
}
## run code to generate objects
# source('./Residuals/ss3residualsdiag.R') ## calls ss3runsFun within it
lendat <- get_ss3compsTA1.8(base_case,type="len") # here size (default is length)
## Fig 4 Runs Test MeanL ----
## facet by fleet, point and line with residuals, green if passed overall,
## alpha rectangle indicating output of runs.sig3
mlRes <- lendat$runs_dat %>%
select(-Fleet) %>%
merge(.,nm, by.x = "Fleet_name", by.y = "Current.names") %>%
mutate(Fleet =  New.names) %>%
select(Fleet, Yr, Obs, Exp, -Fleet_name,  -New.names) %>%
mutate(logResidual =  log(Obs) - log(Exp))
mlLim <- mlRes %>%
group_by(Fleet) %>%
summarise(pruns = runs.sig3(logResidual)$p.runs,
lwr = runs.sig3(logResidual)$sig3lim[1],
upr = abs(lwr),
passFail = pruns > 0.05,
medResidlt3 = median(abs(logResidual))<3,
minYr = min(Yr), maxYr = max(Yr)) %>%
filter(medResidlt3)
if(type=="resid"){mu = 0}else{mu = mean(x, na.rm = TRUE)}
## Fig 4 Runs Test MeanL ----
## facet by fleet, point and line with residuals, green if passed overall,
## alpha rectangle indicating output of runs.sig3
mlRes <- lendat$runs_dat %>%
select(-Fleet) %>%
merge(.,nm, by.x = "Fleet_name", by.y = "Current.names") %>%
mutate(Fleet =  New.names) %>%
select(Fleet, Yr, Obs, Exp, -Fleet_name,  -New.names) %>%
mutate(logResidual =  log(Obs) - log(Exp))
mlLim <- mlRes %>%
group_by(Fleet) %>%
summarise(pruns = runs.sig3(logResidual)$p.runs,
lwr = runs.sig3(logResidual)$sig3lim[1],
upr = abs(lwr),
passFail = pruns > 0.05,
medResidlt3 = median(abs(logResidual))<3,
minYr = min(Yr), maxYr = max(Yr)) %>%
filter(medResidlt3)
runs.sig3 <- function(x,type="resid") {
if(type=="resid"){mu = 0}else{mu = mean(x, na.rm = TRUE)}
# Average moving range
mr  <- abs(diff(x - mu))
amr <- mean(mr, na.rm = TRUE)
# Upper limit for moving ranges
ulmr <- 3.267 * amr
# Remove moving ranges greater than ulmr and recalculate amr, Nelson 1982
mr  <- mr[mr < ulmr]
amr <- mean(mr, na.rm = TRUE)
# Calculate standard deviation, Montgomery, 6.33
stdev <- amr / 1.128
# Calculate control limits
lcl <- mu - 3 * stdev
ucl <- mu + 3 * stdev
if(nlevels(factor(sign(x)))>1){ pvalue = round(tseries::runs.test(factor(sign(x)))$p.value,3)} else {
pvalue = 0.001
}
return(list(sig3lim=c(lcl,ucl),p.runs= pvalue))
}
mlLim <- mlRes %>%
group_by(Fleet) %>%
summarise(pruns = runs.sig3(logResidual)$p.runs,
lwr = runs.sig3(logResidual)$sig3lim[1],
upr = abs(lwr),
passFail = pruns > 0.05,
medResidlt3 = median(abs(logResidual))<3,
minYr = min(Yr), maxYr = max(Yr)) %>%
filter(medResidlt3)
mlRunsDat <- merge(mlRes,mlLim,"Fleet")
ggplot(mlRunsDat, aes(x = Yr, y = logResidual)) +
theme_bw() +
geom_rect(data =mlLim,  aes(x = minYr, y =upr, ## strangely need this to avoid overplotting
xmin = minYr, xmax = maxYr,
ymin = -Inf,
ymax = Inf),
fill = ifelse(mlLim$passFail,
'seagreen3','red' ), alpha = 0.75)  +
theme(panel.background = element_rect(fill = ifelse(mlRunsDat$medResidlt3,
'seagreen3','red' )),
panel.grid = element_blank(),
strip.text = element_text(size = 16),
axis.text = element_text(size = 10),
axis.title =  element_text(size = 12),
legend.position = 'none') +
geom_line(lwd = 0.6) +
geom_point(shape = 19, size = 2) +
geom_rect(data =mlLim,  aes(x = minYr, y =upr, ## strangely need this to avoid overplotting
xmin = minYr, xmax = maxYr, ymin = lwr, ymax = upr),
alpha = 0.5, fill = 'grey22')  +
facet_wrap(~Fleet, scales = 'free_x', ncol = 5) +
labs(x = 'Year', y = 'log residual')
require(ggplot2)
ggplot(mlRunsDat, aes(x = Yr, y = logResidual)) +
theme_bw() +
geom_rect(data =mlLim,  aes(x = minYr, y =upr, ## strangely need this to avoid overplotting
xmin = minYr, xmax = maxYr,
ymin = -Inf,
ymax = Inf),
fill = ifelse(mlLim$passFail,
'seagreen3','red' ), alpha = 0.75)  +
theme(panel.background = element_rect(fill = ifelse(mlRunsDat$medResidlt3,
'seagreen3','red' )),
panel.grid = element_blank(),
strip.text = element_text(size = 16),
axis.text = element_text(size = 10),
axis.title =  element_text(size = 12),
legend.position = 'none') +
geom_line(lwd = 0.6) +
geom_point(shape = 19, size = 2) +
geom_rect(data =mlLim,  aes(x = minYr, y =upr, ## strangely need this to avoid overplotting
xmin = minYr, xmax = maxYr, ymin = lwr, ymax = upr),
alpha = 0.5, fill = 'grey22')  +
facet_wrap(~Fleet, scales = 'free_x', ncol = 5) +
labs(x = 'Year', y = 'log residual')
## I updated these so they are in GGPLOT and match the formatting of previous plots
# 1) In all plots update the name of the CPUE's for "CPUE_1" "CPUE_2" etc
# 2) On runs test panel add  Yaxis label "Log residuals" and X axis "Year"
# 3) Increase resolution of all residuals plots if possible.
p1 <- recProf %>%
melt(id = 'SR_LN.R0.' ) %>%
ggplot(., aes(x = SR_LN.R0., y = value, col = variable)) +
theme_bw() +
theme(panel.grid = element_blank(),
legend.position = c(0.75,0.75),
legend.text = element_text(size = 14),
legend.background = element_blank(),
axis.text = element_text(size = 14),
axis.title = element_text(size = 14)) +
geom_line(lwd = 1.1) +
scale_color_viridis_d() +
labs(x =expression("ln(R"[0]*")"), y = "Change in Log-Likelihood", col = "")
p2 <- compProf %>%
melt(id = 'LNR0' ) %>%
ggplot(., aes(x = LNR0, y = value, col = variable)) +
theme_bw() +
theme(panel.grid = element_blank(),
legend.position = c(0.75,0.75),
legend.text = element_text(size = 14),
legend.background = element_blank(),
axis.text = element_text(size = 14),
axis.title = element_text(size = 14)) +
geom_line(lwd = 1.1) +
scale_color_viridis_d() +
labs(x =expression("ln(R"[0]*")"), y = "Change in Log-Likelihood", col = "")
p3 <- idxProf %>%
melt(id = 'LNR0' ) %>%
ggplot(., aes(x = LNR0, y = value, col = variable)) +
theme_classic() +
theme(panel.grid = element_blank(),
legend.position = c(0.75,0.75),
legend.text = element_text(size = 14),
legend.background = element_blank(),
axis.text = element_text(size = 14),
axis.title = element_text(size = 14)) +
geom_line(lwd = 1.1) +
scale_color_viridis_d() +
labs(x =expression("ln(R"[0]*")"), y = "Change in Log-Likelihood", col = "")
require(dplyr)
require(r4ss)
require(ggplot2)
require(patchwork) #devtools::install_github("thomasp85/patchwork")
require(reshape2)
require(tseries)
## I updated these so they are in GGPLOT and match the formatting of previous plots
# 1) In all plots update the name of the CPUE's for "CPUE_1" "CPUE_2" etc
# 2) On runs test panel add  Yaxis label "Log residuals" and X axis "Year"
# 3) Increase resolution of all residuals plots if possible.
p1 <- recProf %>%
melt(id = 'SR_LN.R0.' ) %>%
ggplot(., aes(x = SR_LN.R0., y = value, col = variable)) +
theme_bw() +
theme(panel.grid = element_blank(),
legend.position = c(0.75,0.75),
legend.text = element_text(size = 14),
legend.background = element_blank(),
axis.text = element_text(size = 14),
axis.title = element_text(size = 14)) +
geom_line(lwd = 1.1) +
scale_color_viridis_d() +
labs(x =expression("ln(R"[0]*")"), y = "Change in Log-Likelihood", col = "")
p2 <- compProf %>%
melt(id = 'LNR0' ) %>%
ggplot(., aes(x = LNR0, y = value, col = variable)) +
theme_bw() +
theme(panel.grid = element_blank(),
legend.position = c(0.75,0.75),
legend.text = element_text(size = 14),
legend.background = element_blank(),
axis.text = element_text(size = 14),
axis.title = element_text(size = 14)) +
geom_line(lwd = 1.1) +
scale_color_viridis_d() +
labs(x =expression("ln(R"[0]*")"), y = "Change in Log-Likelihood", col = "")
p2 <- lencompProf %>%
melt(id = 'LNR0' ) %>%
ggplot(., aes(x = LNR0, y = value, col = variable)) +
theme_bw() +
theme(panel.grid = element_blank(),
legend.position = c(0.75,0.75),
legend.text = element_text(size = 14),
legend.background = element_blank(),
axis.text = element_text(size = 14),
axis.title = element_text(size = 14)) +
geom_line(lwd = 1.1) +
scale_color_viridis_d() +
labs(x =expression("ln(R"[0]*")"), y = "Change in Log-Likelihood", col = "")
p3 <- idxProf %>%
melt(id = 'LNR0' ) %>%
ggplot(., aes(x = LNR0, y = value, col = variable)) +
theme_classic() +
theme(panel.grid = element_blank(),
legend.position = c(0.75,0.75),
legend.text = element_text(size = 14),
legend.background = element_blank(),
axis.text = element_text(size = 14),
axis.title = element_text(size = 14)) +
geom_line(lwd = 1.1) +
scale_color_viridis_d() +
labs(x =expression("ln(R"[0]*")"), y = "Change in Log-Likelihood", col = "")
(p1 | p2  |p3)
## I updated these so they are in GGPLOT and match the formatting of previous plots
# 1) In all plots update the name of the CPUE's for "CPUE_1" "CPUE_2" etc
# 2) On runs test panel add  Yaxis label "Log residuals" and X axis "Year"
# 3) Increase resolution of all residuals plots if possible.
p1 <- recProf %>%
melt(id = 'SR_LN.R0.' ) %>%
ggplot(., aes(x = SR_LN.R0., y = value, col = variable)) +
theme_bw() +
theme(panel.grid = element_blank(),
legend.position = c(0.1,0.75),
legend.text = element_text(size = 14),
legend.background = element_blank(),
axis.text = element_text(size = 14),
axis.title = element_text(size = 14)) +
geom_line(lwd = 1.1) +
scale_color_viridis_d() +
labs(x =expression("ln(R"[0]*")"), y = "Change in Log-Likelihood", col = "")
p2 <- lencompProf %>%
melt(id = 'LNR0' ) %>%
ggplot(., aes(x = LNR0, y = value, col = variable)) +
theme_bw() +
theme(panel.grid = element_blank(),
legend.position = c(0.1,0.75),
legend.text = element_text(size = 14),
legend.background = element_blank(),
axis.text = element_text(size = 14),
axis.title = element_text(size = 14)) +
geom_line(lwd = 1.1) +
scale_color_viridis_d() +
labs(x =expression("ln(R"[0]*")"), y = "Change in Log-Likelihood", col = "")
p3 <- idxProf %>%
melt(id = 'LNR0' ) %>%
ggplot(., aes(x = LNR0, y = value, col = variable)) +
theme_classic() +
theme(panel.grid = element_blank(),
legend.position = c(0.1,0.75),
legend.text = element_text(size = 14),
legend.background = element_blank(),
axis.text = element_text(size = 14),
axis.title = element_text(size = 14)) +
geom_line(lwd = 1.1) +
scale_color_viridis_d() +
labs(x =expression("ln(R"[0]*")"), y = "Change in Log-Likelihood", col = "")
(p1 | p2  |p3)
## I updated these so they are in GGPLOT and match the formatting of previous plots
# 1) In all plots update the name of the CPUE's for "CPUE_1" "CPUE_2" etc
# 2) On runs test panel add  Yaxis label "Log residuals" and X axis "Year"
# 3) Increase resolution of all residuals plots if possible.
p1 <- recProf %>%
melt(id = 'SR_LN.R0.' ) %>%
ggplot(., aes(x = SR_LN.R0., y = value, col = variable)) +
theme_bw() +
theme(panel.grid = element_blank(),
legend.position = c(0.25,0.75),
legend.text = element_text(size = 14),
legend.background = element_blank(),
axis.text = element_text(size = 14),
axis.title = element_text(size = 14)) +
geom_line(lwd = 1.1) +
scale_color_viridis_d() +
labs(x =expression("ln(R"[0]*")"), y = "Change in Log-Likelihood", col = "")
p2 <- lencompProf %>%
melt(id = 'LNR0' ) %>%
ggplot(., aes(x = LNR0, y = value, col = variable)) +
theme_bw() +
theme(panel.grid = element_blank(),
legend.position = c(0.25,0.75),
legend.text = element_text(size = 14),
legend.background = element_blank(),
axis.text = element_text(size = 14),
axis.title = element_text(size = 14)) +
geom_line(lwd = 1.1) +
scale_color_viridis_d() +
labs(x =expression("ln(R"[0]*")"), y = "Change in Log-Likelihood", col = "")
p3 <- idxProf %>%
melt(id = 'LNR0' ) %>%
ggplot(., aes(x = LNR0, y = value, col = variable)) +
theme_classic() +
theme(panel.grid = element_blank(),
legend.position = c(0.25,0.75),
legend.text = element_text(size = 14),
legend.background = element_blank(),
axis.text = element_text(size = 14),
axis.title = element_text(size = 14)) +
geom_line(lwd = 1.1) +
scale_color_viridis_d() +
labs(x =expression("ln(R"[0]*")"), y = "Change in Log-Likelihood", col = "")
(p1 | p2  |p3)
read.table("./_mod/atl_tuna_max/Profile.csv", skip = 1, sep = ",", header =TRUE)
recProf <- read.table("./_mod/atl_tuna_max/Profile.csv", skip = 1, sep = ",", header =TRUE)[,c(1:3,5,6)]
recProf
## I updated these so they are in GGPLOT and match the formatting of previous plots
# 1) In all plots update the name of the CPUE's for "CPUE_1" "CPUE_2" etc
# 2) On runs test panel add  Yaxis label "Log residuals" and X axis "Year"
# 3) Increase resolution of all residuals plots if possible.
p1 <- recProf %>%
melt(id = 'SR_LN.R0.' ) %>%
ggplot(., aes(x = SR_LN.R0., y = value, col = variable)) +
theme_bw() +
theme(panel.grid = element_blank(),
legend.position = c(0.25,0.75),
legend.text = element_text(size = 14),
legend.background = element_blank(),
axis.text = element_text(size = 14),
axis.title = element_text(size = 14)) +
geom_line(lwd = 1.1) +
scale_color_viridis_d() +
labs(x =expression("ln(R"[0]*")"), y = "Change in Log-Likelihood", col = "")
(p1 | p2  |p3)
lencompProf
ggsave((p1 | p2  |p3),
file = "./Fig3_LikelihoodPanel_Max.png",
width = 10, height = 8, dpi = 720, unit = 'in')
